<!-- products/index.ejs -->
<%- include('partials/head', { title: 'Data' }) %>

<head>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script type="module">

      import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
      
      // Declare the chart dimensions and margins.
      const width = 640;
      const height = 400;
      const marginTop = 20;
      const marginRight = 20;
      const marginBottom = 30;
      const marginLeft = 40;
      
      // Declare the x (horizontal position) scale.
      const x = d3.scaleUtc()
          .domain([new Date("2025-01-01"), new Date("2026-01-01")])
          .range([marginLeft, width - marginRight]);
      
      // Declare the y (vertical position) scale.
      const y = d3.scaleLinear()
          .domain([0, 100])
          .range([height - marginBottom, marginTop]);
      
      // Create the SVG container.
      const svg = d3.create("svg")
          .attr("width", width)
          .attr("height", height);
      
      // Add the x-axis.
      svg.append("g")
          .attr("transform", `translate(0,${height - marginBottom})`)
          .call(d3.axisBottom(x));
      
      // Add the y-axis.
      svg.append("g")
          .attr("transform", `translate(${marginLeft},0)`)
          .call(d3.axisLeft(y));
      
      // Append the SVG element.
      container.append(svg.node());
      
      </script>
</head>

<div class="index-container2">
    <span>
        <div class="landing-title">Soil Moisture vs. Time</div>
        <div class="landing-text">This chart tracks the soil moisture of our plant. If it falls under [THRESHOLD 1], the plant will automatically water itself. If it's too high above [THRESHOLD 2], the plant will be unable to be watered. If it's in between, feel free to click the "Water" button to water the plant from afar!</div>
        <div id="container"></div>
    </span>
</div>

<!--
        <script>
            function addToCart(product_id, product_name, product_price) {
                fetch('/addToCart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        product_id, 
                        product_name, 
                        product_price, 
                    }),
                })
                .then(response => {
                    if(!response.ok) {
                        throw new Error(`HTTP Error! Status: ${response.status}`)
                    }
                })
            }

            function handleCheckout() {
                console.log("handle checkout")
                fetch('/checkout')
                .then(response => {
                    if(!response.ok) {
                        console.error("oh no");
                    } else {
                        console.log('rerouting');
                        window.location.href = `http://localhost:3000/checkout`;
                    }
                    console.log(response.text());
                })
            }
        </script>

  

        <div class="container" style="margin-top: 3%;">
            <ul class="product-list">
                <% products.forEach(product => { %>
                    <% if(product.display) { %>
                        <li class="product-list-item">
                            <span><img class="image-text" src="<%=product.product_image%>" alt="<%= product.product_name%> Image"></span>
                            <span class="product-text"><%= product.product_name %></span>
                            <span class="price-text">$<%= product.product_price %></span>
                            <span><button class="add-to-cart" onclick="addToCart('<%=product.product_id%>', '<%=product.product_name%>', '<%=product.product_price%>')"></button></span>
                        </li>
                    <% } %>
                <% }); %>
            </ul>
        </div>
-->